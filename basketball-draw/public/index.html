<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®ä¿¡ç¾¤ç¯®çƒæŠ½ç­¾ç³»ç»Ÿ</title>
    <style>
        :root {
            --primary-color: #2196F3;
            --secondary-color: #FF9800;
            --success-color: #4CAF50;
            --danger-color: #F44336;
            --light-bg: #f5f5f5;
            --border-color: #e0e0e0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .header .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 20px;
        }
        
        /* æ ‡ç­¾é¡µæ ·å¼ */
        .tab-nav {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            position: relative;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .tab-btn.active {
            color: var(--primary-color);
        }
        
        .tab-indicator {
            position: absolute;
            bottom: -2px;
            height: 3px;
            background: var(--primary-color);
            transition: all 0.3s;
            border-radius: 3px 3px 0 0;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: var(--light-bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
        }
        
        .info-card {
            background: #E3F2FD;
            border-left: 4px solid var(--primary-color);
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
        }
        
        .error-card {
            background: #FFEBEE;
            border-left: 4px solid var(--danger-color);
            display: none;
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 0.95rem;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.95rem;
            transition: all 0.3s;
            background: white;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }
        
        textarea.form-control {
            min-height: 80px;
            resize: vertical;
        }
        
        select.form-control {
            height: 44px;
        }
        
        .form-hint {
            font-size: 0.8rem;
            color: #666;
            margin-top: 4px;
            display: block;
        }
        
        .form-error {
            color: var(--danger-color);
            font-size: 0.8rem;
            margin-top: 4px;
            display: none;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn {
            display: inline-block;
            padding: 12px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            text-decoration: none;
            position: relative;
            overflow: hidden;
            width: 100%;
        }
        
        .btn:hover {
            background: #1976D2;
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(33, 150, 243, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: var(--secondary-color);
        }
        
        .btn-secondary:hover {
            background: #F57C00;
        }
        
        .btn-success {
            background: var(--success-color);
        }
        
        .btn-success:hover {
            background: #388E3C;
        }
        
        .btn-danger {
            background: var(--danger-color);
        }
        
        .btn-danger:hover {
            background: #D32F2F;
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* æ¶ˆæ¯æç¤º */
        .message {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: slideIn 0.3s ease;
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .message.success {
            background: #E8F5E9;
            color: var(--success-color);
            border: 1px solid #C8E6C9;
        }
        
        .message.error {
            background: #FFEBEE;
            color: var(--danger-color);
            border: 1px solid #FFCDD2;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* æŠ½ç­¾ç»“æœé¡µé¢ */
        .draw-page {
            display: none;
        }
        
        .draw-header {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 0 0 20px 20px;
        }
        
        .draw-code {
            display: inline-block;
            background: white;
            color: var(--primary-color);
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            margin: 8px 0;
            font-size: 1.1rem;
        }
        
        /* å‚ä¸è€…ä¿¡æ¯æ ·å¼ */
        .participant-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #E3F2FD;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .participant-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #1976D2;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .participant-details {
            flex: 1;
        }
        
        .participant-name {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .participant-status {
            font-size: 0.8rem;
            color: #666;
        }
        
        /* é˜Ÿä¼é€‰æ‹©å™¨ */
        .team-selector {
            text-align: center;
            margin: 20px 0;
        }
        
        .team-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 12px;
            background: white;
            transition: all 0.3s;
        }
        
        .team-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
            outline: none;
        }
        
        .selection-result {
            background: #E8F5E9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        /* åˆ†ç»„æ˜¾ç¤º */
        .groups-container {
            margin: 20px 0;
        }
        
        .group-card {
            border: 2px solid var(--border-color);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        
        .group-card:hover {
            border-color: var(--primary-color);
        }
        
        .group-header {
            background: var(--primary-color);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .group-body {
            padding: 15px;
            background: white;
        }
        
        .team-list {
            list-style: none;
        }
        
        .team-item {
            padding: 10px;
            margin-bottom: 6px;
            background: white;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .team-item:hover {
            background: #f9f9f9;
        }
        
        /* è¿›åº¦æ¡ */
        .progress-container {
            margin: 15px 0;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .progress-bar {
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), #8BC34A);
            transition: width 0.5s ease;
            width: 0%;
        }
        
        /* åˆ†äº«æ ·å¼ */
        .share-section {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
        }
        
        .share-link {
            background: white;
            border: 2px dashed var(--primary-color);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            word-break: break-all;
            text-align: left;
            font-size: 0.9rem;
        }
        
        .share-link a {
            color: var(--primary-color);
            font-weight: 600;
            text-decoration: none;
        }
        
        .share-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .share-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .share-btn.copy {
            background: var(--primary-color);
            color: white;
        }
        
        .share-btn.copy:hover {
            background: #1976D2;
        }
        
        .share-btn.back {
            background: #666;
            color: white;
        }
        
        .share-btn.back:hover {
            background: #555;
        }
        
        /* è‡ªå®šä¹‰é…ç½®åŒºåŸŸ */
        .custom-config-section {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .config-example {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
            background: white;
            padding: 8px;
            border-radius: 4px;
            border: 1px dashed #ccc;
        }
        
        /* å¾½ç«  */
        .badge {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .badge-success {
            background: var(--success-color);
            color: white;
        }
        
        .badge-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .badge-warning {
            background: var(--secondary-color);
            color: white;
        }
        
        /* åˆ†é…è§„åˆ™è¯´æ˜ */
        .rules-info {
            background: #E8F5E9;
            border: 1px solid #C8E6C9;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-size: 0.9rem;
        }
        
        .rules-info h4 {
            color: var(--success-color);
            margin-bottom: 8px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (min-width: 768px) {
            .container {
                max-width: 800px;
                margin: 20px auto;
                min-height: auto;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            }
            
            .header {
                border-radius: 15px 15px 0 0;
            }
            
            .content {
                padding: 25px;
            }
            
            .message {
                left: 50%;
                transform: translateX(-50%);
                max-width: 400px;
            }
        }
        
        @media (max-width: 767px) {
            .share-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- æ¶ˆæ¯æç¤ºå®¹å™¨ -->
    <div id="messageContainer"></div>
    
    <div class="container">
        <!-- ä¸»é¡µé¢ -->
        <div id="mainPage">
            <div class="header">
                <h1>ğŸ€ å¾®ä¿¡ç¾¤ç¯®çƒæŠ½ç­¾ç³»ç»Ÿ</h1>
                <div class="subtitle">åˆ›å»ºè€…è®¾å®šç§å­é˜Ÿ | å‚ä¸è€…é€‰æ‹©é˜Ÿä¼ | å®æ—¶åˆ†ç»„</div>
            </div>
            
            <div class="content">
                <!-- å¯¼èˆªæ ‡ç­¾ -->
                <div class="tab-nav">
                    <button class="tab-btn active" data-tab="create">åˆ›å»ºæŠ½ç­¾</button>
                    <button class="tab-btn" data-tab="join">å‚ä¸æŠ½ç­¾</button>
                    <button class="tab-btn" data-tab="manage">ç®¡ç†æŠ½ç­¾</button>
                    <div class="tab-indicator" id="tabIndicator"></div>
                </div>
                
                <!-- åˆ›å»ºæŠ½ç­¾é¡µé¢ -->
                <div class="tab-pane active" id="createTab">
                    <div class="info-card">
                        ğŸ’¡ <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                        1. è®¾å®šåˆ†ç»„å’Œç§å­é˜Ÿ<br>
                        2. åˆ†äº«é“¾æ¥åˆ°å¾®ä¿¡ç¾¤<br>
                        3. å‚ä¸è€…é€‰æ‹©é˜Ÿä¼åç§°<br>
                        4. ç³»ç»Ÿè‡ªåŠ¨åˆ†ç»„ï¼Œå®æ—¶æ˜¾ç¤ºç»“æœ
                    </div>
                    
                    <div class="form-group">
                        <label for="drawName">æŠ½ç­¾åç§° *</label>
                        <input type="text" id="drawName" class="form-control" placeholder="ä¾‹å¦‚ï¼š2024æ˜¥å­£ç¯®çƒè”èµ›">
                        <span class="form-hint">ä¸ºæŠ½ç­¾æ´»åŠ¨å‘½å</span>
                        <span class="form-error" id="drawNameError"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="creatorName">åˆ›å»ºè€…æ˜µç§° *</label>
                        <input type="text" id="creatorName" class="form-control" placeholder="æ‚¨çš„æ˜µç§°">
                        <span class="form-hint">æ‚¨çš„æ˜µç§°å°†æ˜¾ç¤ºä¸ºåˆ›å»ºè€…</span>
                        <span class="form-error" id="creatorNameError"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="teamList">æ‰€æœ‰é˜Ÿä¼åç§° *</label>
                        <textarea id="teamList" class="form-control" placeholder="æ¯è¡Œè¾“å…¥ä¸€ä¸ªé˜Ÿä¼åç§°&#10;ä¾‹å¦‚ï¼š&#10;æ¹–äººé˜Ÿ&#10;å‹‡å£«é˜Ÿ&#10;å‡¯å°”ç‰¹äººé˜Ÿ&#10;çƒ­ç«é˜Ÿ&#10;å…¬ç‰›é˜Ÿ&#10;é©¬åˆºé˜Ÿ"></textarea>
                        <span class="form-hint">æ‰€æœ‰å‚èµ›é˜Ÿä¼ï¼Œæ¯è¡Œä¸€ä¸ªé˜Ÿå</span>
                        <span class="form-error" id="teamListError"></span>
                    </div>
                    
                    <div class="info-card">
                        ğŸ”’ <strong>ç§å­é˜Ÿè¯´æ˜ï¼š</strong><br>
                        ç§å­é˜Ÿç”±åˆ›å»ºè€…è®¾å®šï¼Œå‚ä¸è€…æ— æ³•åŒºåˆ†ç§å­é˜Ÿä¸æ™®é€šé˜Ÿã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨ç¡®ä¿ç§å­é˜Ÿå‡è¡¡åˆ†é…åˆ°ä¸åŒå°ç»„ã€‚
                    </div>
                    
                    <div class="form-group">
                        <label for="seedTeams">ç§å­é˜Ÿä¼ï¼ˆå¯å¤šé€‰ï¼‰</label>
                        <select id="seedTeams" class="form-control" multiple style="height: 100px;">
                            <option value="" disabled selected>è¯·å…ˆä»ä¸Šæ–¹è¾“å…¥é˜Ÿä¼åç§°</option>
                        </select>
                        <span class="form-hint">æŒ‰ä½ Ctrl/Command é”®å¯å¤šé€‰ç§å­é˜Ÿä¼ï¼Œæˆ–æŒ‰ä½ Shift é”®è¿›è¡ŒèŒƒå›´é€‰æ‹©</span>
                        <span class="form-error" id="seedTeamsError"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="groupConfig">åˆ†ç»„é…ç½® *</label>
                        <select id="groupConfig" class="form-control">
                            <option value="">è¯·é€‰æ‹©åˆ†ç»„é…ç½®</option>
                            <option value="A:3,B:3">2ç»„ï¼Œæ¯ç»„3é˜Ÿï¼ˆå…±6é˜Ÿï¼‰</option>
                            <option value="A:4,B:4">2ç»„ï¼Œæ¯ç»„4é˜Ÿï¼ˆå…±8é˜Ÿï¼‰</option>
                            <option value="A:3,B:3,C:3">3ç»„ï¼Œæ¯ç»„3é˜Ÿï¼ˆå…±9é˜Ÿï¼‰</option>
                            <option value="A:3,B:3,C:2,D:2">4ç»„ï¼Œå…±10é˜Ÿ</option>
                            <option value="A:4,B:4,C:4">3ç»„ï¼Œæ¯ç»„4é˜Ÿï¼ˆå…±12é˜Ÿï¼‰</option>
                            <option value="A:4,B:4,C:4,D:4">4ç»„ï¼Œæ¯ç»„4é˜Ÿï¼ˆå…±16é˜Ÿï¼‰</option>
                            <option value="custom">è‡ªå®šä¹‰é…ç½®...</option>
                        </select>
                        <span class="form-hint">é€‰æ‹©é¢„è®¾é…ç½®æˆ–è‡ªå®šä¹‰</span>
                        <span class="form-error" id="groupConfigError"></span>
                    </div>
                    
                    <!-- è‡ªå®šä¹‰é…ç½®åŒºåŸŸ -->
                    <div id="customConfigSection" class="custom-config-section">
                        <div class="form-group">
                            <label for="customConfig">è‡ªå®šä¹‰åˆ†ç»„é…ç½® *</label>
                            <input type="text" id="customConfig" class="form-control" placeholder="æ ¼å¼ï¼šA:3,B:3,C:3,D:3,E:3,F:3,G:3,H:3,I:3,J:3,K:2,L:2,M:2,N:2,O:2,P:2">
                            <span class="form-hint">æ ¼å¼ï¼šç»„å:é˜Ÿä¼æ•°é‡,ç»„å:é˜Ÿä¼æ•°é‡,...ï¼ˆå¦‚ï¼šA:3,B:3,C:3 è¡¨ç¤º3ä¸ªå°ç»„ï¼Œæ¯ç»„3é˜Ÿï¼‰</span>
                            <div class="config-example">
                                <strong>ç¤ºä¾‹ï¼š</strong><br>
                                42é˜Ÿï¼Œ16ç»„ï¼ˆ10ç»„3é˜Ÿï¼Œ6ç»„2é˜Ÿï¼‰ï¼š<br>
                                A:3,B:3,C:3,D:3,E:3,F:3,G:3,H:3,I:3,J:3,K:2,L:2,M:2,N:2,O:2,P:2
                            </div>
                            <span class="form-error" id="customConfigError"></span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">ç®¡ç†å¯†ç  *</label>
                        <input type="text" id="password" class="form-control" placeholder="è®¾ç½®ç®¡ç†å¯†ç ">
                        <span class="form-hint">è¯·è®°ä½æ­¤å¯†ç ï¼Œç”¨äºç®¡ç†æŠ½ç­¾</span>
                        <span class="form-error" id="passwordError"></span>
                    </div>
                    
                    <button class="btn" onclick="createDraw()" id="createBtn">åˆ›å»ºæŠ½ç­¾</button>
                </div>
                
                <!-- å‚ä¸æŠ½ç­¾é¡µé¢ -->
                <div class="tab-pane" id="joinTab">
                    <div class="info-card">
                        ğŸ¯ <strong>å‚ä¸æŠ½ç­¾ï¼š</strong><br>
                        1. è¾“å…¥æŠ½ç­¾é“¾æ¥ä¸­çš„ID<br>
                        2. ä»åˆ—è¡¨ä¸­é€‰æ‹©æ‚¨çš„é˜Ÿä¼<br>
                        3. ç«‹å³æŸ¥çœ‹åˆ†ç»„ç»“æœ
                    </div>
                    
                    <div class="form-group">
                        <label for="joinCode">æŠ½ç­¾ID *</label>
                        <input type="text" id="joinCode" class="form-control" placeholder="è¾“å…¥æŠ½ç­¾é“¾æ¥ä¸­çš„IDï¼ˆå¦‚ï¼šABC123ï¼‰">
                        <span class="form-hint">å¯ä»¥ä»åˆ›å»ºè€…åˆ†äº«çš„é“¾æ¥ä¸­è·å–</span>
                        <span class="form-error" id="joinCodeError"></span>
                    </div>
                    
                    <button class="btn" onclick="joinDraw()" id="joinBtn">å‚ä¸æŠ½ç­¾</button>
                </div>
                
                <!-- ç®¡ç†æŠ½ç­¾é¡µé¢ -->
                <div class="tab-pane" id="manageTab">
                    <div class="info-card">
                        ğŸ”§ <strong>ç®¡ç†åŠŸèƒ½ï¼š</strong><br>
                        1. æŸ¥çœ‹æŠ½ç­¾è¯¦æƒ…<br>
                        2. é‡ç½®æŠ½ç­¾çŠ¶æ€<br>
                        3. å¯¼å‡ºæŠ½ç­¾æ•°æ®
                    </div>
                    
                    <div class="form-group">
                        <label for="manageCode">æŠ½ç­¾ID *</label>
                        <input type="text" id="manageCode" class="form-control" placeholder="è¾“å…¥æŠ½ç­¾ID">
                        <span class="form-error" id="manageCodeError"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="managePassword">ç®¡ç†å¯†ç  *</label>
                        <input type="text" id="managePassword" class="form-control" placeholder="è¾“å…¥ç®¡ç†å¯†ç ">
                        <span class="form-error" id="managePasswordError"></span>
                    </div>
                    
                    <button class="btn" onclick="manageDraw()" id="manageBtn">ç®¡ç†æŠ½ç­¾</button>
                </div>
            </div>
        </div>
        
        <!-- æŠ½ç­¾ç»“æœé¡µé¢ -->
        <div id="drawPage" class="draw-page">
            <div class="draw-header">
                <h2 id="drawTitle">æŠ½ç­¾åç§°</h2>
                <div>æŠ½ç­¾ID: <span class="draw-code" id="drawIdDisplay"></span></div>
                <div>åˆ›å»ºè€…: <strong id="drawCreator"></strong></div>
                <div style="margin-top: 8px;">
                    <span class="badge badge-primary" id="remainingTeams">0</span> å‰©ä½™é˜Ÿä¼
                    <span class="badge badge-success" id="totalCapacity">0</span> æ€»å®¹é‡
                </div>
            </div>
            
            <div class="content">
                <!-- åˆ†é…è§„åˆ™è¯´æ˜ -->
                <div class="rules-info" id="rulesInfo">
                    <h4>ğŸ“‹ æŠ½ç­¾è§„åˆ™è¯´æ˜ï¼š</h4>
                    <div id="rulesContent">
                        å‚ä¸è€…é€‰æ‹©é˜Ÿä¼åï¼Œç³»ç»Ÿå°†éšæœºåˆ†é…åˆ°æœ‰ç©ºä½çš„å°ç»„ï¼Œç¡®ä¿åˆ†ç»„å‡è¡¡ã€‚
                    </div>
                </div>
                
                <!-- å‚ä¸è€…ä¿¡æ¯è¾“å…¥ -->
                <div id="participantForm">
                    <div class="info-card">
                        ğŸ‘¤ <strong>å¡«å†™ä¿¡æ¯å‚ä¸æŠ½ç­¾ï¼š</strong><br>
                        è¯·å¡«å†™æ‚¨çš„å§“åå¹¶é€‰æ‹©é˜Ÿä¼åç§°ï¼Œæ¯ä¸ªé˜Ÿä¼åªèƒ½è¢«é€‰æ‹©ä¸€æ¬¡ã€‚
                    </div>
                    
                    <div class="form-group">
                        <label for="participantName">æ‚¨çš„å§“å *</label>
                        <input type="text" id="participantName" class="form-control" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
                        <span class="form-hint">ç”¨äºæ ‡è¯†æ‚¨é€‰æ‹©çš„é˜Ÿä¼</span>
                        <span class="form-error" id="participantNameError"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="availableTeams">é€‰æ‹©é˜Ÿä¼ *</label>
                        <select id="availableTeams" class="form-control team-select">
                            <option value="" disabled selected>è¯·é€‰æ‹©æ‚¨çš„é˜Ÿä¼...</option>
                        </select>
                        <span class="form-hint">æ¯ä¸ªé˜Ÿä¼åªèƒ½è¢«é€‰æ‹©ä¸€æ¬¡</span>
                        <span class="form-error" id="availableTeamsError"></span>
                    </div>
                    
                    <button class="btn btn-success" onclick="participateDraw()" id="participateBtn">ç¡®è®¤å‚ä¸</button>
                </div>
                
                <!-- å·²å‚ä¸æç¤º -->
                <div id="alreadyParticipated" class="info-card" style="display: none;">
                    <strong>âœ… æ‚¨å·²å‚ä¸æŠ½ç­¾</strong><br>
                    <div id="myTeamInfo"></div>
                    <!-- å·²åˆ é™¤"é‡æ–°å‚ä¸"æŒ‰é’® -->
                </div>
                
                <!-- è¿›åº¦æ˜¾ç¤º -->
                <div class="progress-container">
                    <div class="progress-text">
                        <span>æŠ¥åè¿›åº¦</span>
                        <span id="progressText">0/0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
                
                <!-- åˆ†ç»„ç»“æœ -->
                <h3>åˆ†ç»„ç»“æœ</h3>
                <div class="groups-container" id="groupsContainer">
                    <!-- åˆ†ç»„å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <!-- åˆ†äº«åŒºåŸŸ -->
                <div class="share-section">
                    <h3>åˆ†äº«æŠ½ç­¾</h3>
                    <p>å°†æ­¤é“¾æ¥åˆ†äº«åˆ°å¾®ä¿¡ç¾¤ï¼š</p>
                    <div class="share-link">
                        <span id="shareLink">åŠ è½½ä¸­...</span>
                    </div>
                    <div class="share-buttons">
                        <button class="share-btn copy" onclick="copyShareLink()">
                            <span>ğŸ“‹</span> å¤åˆ¶é“¾æ¥
                        </button>
                        <button class="share-btn back" onclick="backToMain()">
                            <span>â†</span> è¿”å›ä¸»é¡µ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let draws = JSON.parse(localStorage.getItem('basketballDraws') || '{}');
        let currentDraw = null;
        let selectedTeam = null;
        let currentParticipant = null;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æŠ½ç­¾ç³»ç»Ÿå·²åˆå§‹åŒ–');
            
            // è®¾ç½®æ ‡ç­¾é¡µåˆ‡æ¢
            setupTabs();
            
            // ç›‘å¬é˜Ÿä¼åˆ—è¡¨è¾“å…¥ï¼Œæ›´æ–°ç§å­é˜Ÿä¼é€‰æ‹©
            document.getElementById('teamList').addEventListener('input', updateSeedTeamsSelect);
            
            // ç›‘å¬åˆ†ç»„é…ç½®é€‰æ‹©
            document.getElementById('groupConfig').addEventListener('change', function() {
                if (this.value === 'custom') {
                    document.getElementById('customConfigSection').style.display = 'block';
                } else {
                    document.getElementById('customConfigSection').style.display = 'none';
                }
            });
            
            // æ£€æŸ¥URLä¸­æ˜¯å¦æœ‰æŠ½ç­¾ID
            const urlParams = new URLSearchParams(window.location.search);
            const drawId = urlParams.get('id');
            
            if (drawId && draws[drawId]) {
                currentDraw = draws[drawId];
                showDrawPage();
            }
        });
        
        // è®¾ç½®æ ‡ç­¾é¡µåˆ‡æ¢
        function setupTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabIndicator = document.getElementById('tabIndicator');
            const tabPanes = document.querySelectorAll('.tab-pane');
            
            // è®¾ç½®åˆå§‹æŒ‡ç¤ºå™¨ä½ç½®
            const activeTab = document.querySelector('.tab-btn.active');
            if (activeTab) {
                const tabWidth = 100 / tabBtns.length;
                const tabIndex = Array.from(tabBtns).indexOf(activeTab);
                tabIndicator.style.width = `${tabWidth}%`;
                tabIndicator.style.left = `${tabIndex * tabWidth}%`;
            }
            
            // ä¸ºæ¯ä¸ªæ ‡ç­¾æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            tabBtns.forEach((btn, index) => {
                btn.addEventListener('click', function() {
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    tabBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // æ›´æ–°æŒ‡ç¤ºå™¨ä½ç½®
                    const tabWidth = 100 / tabBtns.length;
                    tabIndicator.style.width = `${tabWidth}%`;
                    tabIndicator.style.left = `${index * tabWidth}%`;
                    
                    // æ˜¾ç¤ºå¯¹åº”çš„æ ‡ç­¾é¡µ
                    const tabId = this.getAttribute('data-tab');
                    tabPanes.forEach(pane => {
                        pane.classList.remove('active');
                        if (pane.id === `${tabId}Tab`) {
                            pane.classList.add('active');
                        }
                    });
                    
                    // éšè—æ¶ˆæ¯æç¤º
                    hideMessages();
                });
            });
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(type, text) {
            // ç§»é™¤ç°æœ‰æ¶ˆæ¯
            hideMessages();
            
            const messageContainer = document.getElementById('messageContainer');
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.innerHTML = `
                <span>${type === 'success' ? 'âœ…' : 'âŒ'}</span>
                <span>${text}</span>
            `;
            
            messageContainer.appendChild(message);
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                message.style.opacity = '0';
                message.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 300);
            }, 3000);
        }
        
        // éšè—æ‰€æœ‰æ¶ˆæ¯
        function hideMessages() {
            const messages = document.querySelectorAll('.message');
            messages.forEach(msg => {
                msg.style.opacity = '0';
                msg.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (msg.parentNode) {
                        msg.parentNode.removeChild(msg);
                    }
                }, 300);
            });
        }
        
        // æ›´æ–°ç§å­é˜Ÿä¼é€‰æ‹©åˆ—è¡¨
        function updateSeedTeamsSelect() {
            const teamList = document.getElementById('teamList').value;
            const seedSelect = document.getElementById('seedTeams');
            
            // æ¸…ç©ºå½“å‰é€‰é¡¹
            seedSelect.innerHTML = '';
            
            // è§£æé˜Ÿä¼åç§°
            const teams = teamList.split('\n')
                .map(t => t.trim())
                .filter(t => t.length > 0);
            
            if (teams.length === 0) {
                seedSelect.innerHTML = '<option value="" disabled selected>è¯·å…ˆè¾“å…¥é˜Ÿä¼åç§°</option>';
                return;
            }
            
            // æ·»åŠ é˜Ÿä¼é€‰é¡¹
            teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team;
                option.textContent = team;
                seedSelect.appendChild(option);
            });
        }
        
        // è§£æåˆ†ç»„é…ç½®
        function parseGroupConfig(configStr) {
            const config = {};
            
            if (!configStr || configStr.trim() === '') {
                return config;
            }
            
            const parts = configStr.split(',');
            
            for (const part of parts) {
                if (part.includes(':')) {
                    const [group, size] = part.split(':');
                    const groupName = group.trim();
                    const groupSize = parseInt(size.trim());
                    
                    if (groupName && !isNaN(groupSize) && groupSize > 0) {
                        config[groupName] = groupSize;
                    }
                }
            }
            
            return config;
        }
        
        // ç”ŸæˆéšæœºID
        function generateId() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ123456789';
            let id = '';
            for (let i = 0; i < 6; i++) {
                id += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return id;
        }
        
        // åˆ›å»ºæŠ½ç­¾
        function createDraw() {
            // è·å–è¡¨å•æ•°æ®
            const drawName = document.getElementById('drawName').value.trim();
            const creatorName = document.getElementById('creatorName').value.trim();
            const password = document.getElementById('password').value.trim();
            const teamListText = document.getElementById('teamList').value.trim();
            const groupConfigSelect = document.getElementById('groupConfig').value;
            
            // è·å–åˆ†ç»„é…ç½®å­—ç¬¦ä¸²
            let groupConfigStr = '';
            if (groupConfigSelect === 'custom') {
                groupConfigStr = document.getElementById('customConfig').value.trim();
                if (!groupConfigStr) {
                    showMessage('error', 'è¯·è¾“å…¥è‡ªå®šä¹‰åˆ†ç»„é…ç½®');
                    return;
                }
            } else {
                groupConfigStr = groupConfigSelect;
            }
            
            // éªŒè¯å¿…å¡«å­—æ®µ
            if (!drawName) {
                showMessage('error', 'è¯·è¾“å…¥æŠ½ç­¾åç§°');
                return;
            }
            
            if (!creatorName) {
                showMessage('error', 'è¯·è¾“å…¥åˆ›å»ºè€…æ˜µç§°');
                return;
            }
            
            if (!teamListText) {
                showMessage('error', 'è¯·è¾“å…¥é˜Ÿä¼åç§°');
                return;
            }
            
            if (!groupConfigStr) {
                showMessage('error', 'è¯·é€‰æ‹©åˆ†ç»„é…ç½®');
                return;
            }
            
            if (!password) {
                showMessage('error', 'è¯·è¾“å…¥ç®¡ç†å¯†ç ');
                return;
            }
            
            // è§£ææ‰€æœ‰é˜Ÿä¼
            const allTeams = teamListText.split('\n')
                .map(t => t.trim())
                .filter(t => t.length > 0);
            
            if (allTeams.length < 2) {
                showMessage('error', 'è¯·è¾“å…¥è‡³å°‘2ä¸ªé˜Ÿä¼åç§°');
                return;
            }
            
            // è§£æåˆ†ç»„é…ç½®
            const groupConfig = parseGroupConfig(groupConfigStr);
            if (Object.keys(groupConfig).length === 0) {
                showMessage('error', 'è¯·é€‰æ‹©æœ‰æ•ˆçš„åˆ†ç»„é…ç½®');
                return;
            }
            
            // è·å–ç§å­é˜Ÿä¼
            const seedSelect = document.getElementById('seedTeams');
            const selectedSeeds = Array.from(seedSelect.selectedOptions).map(opt => opt.value);
            
            // éªŒè¯ç§å­é˜Ÿä¼æ•°é‡
            const groupCount = Object.keys(groupConfig).length;
            if (selectedSeeds.length > groupCount) {
                showMessage('error', `ç§å­é˜Ÿä¼æ•°(${selectedSeeds.length})ä¸èƒ½è¶…è¿‡åˆ†ç»„æ•°(${groupCount})`);
                return;
            }
            
            // è®¡ç®—æ€»å®¹é‡
            const totalCapacity = Object.values(groupConfig).reduce((sum, size) => sum + size, 0);
            
            if (allTeams.length > totalCapacity) {
                showMessage('error', `é˜Ÿä¼æ•°é‡(${allTeams.length})è¶…è¿‡æ€»å®¹é‡(${totalCapacity})ï¼Œè¯·å¢åŠ åˆ†ç»„æˆ–å‡å°‘é˜Ÿä¼`);
                return;
            }
            
            // ç”ŸæˆæŠ½ç­¾ID
            const drawId = generateId();
            
            // åˆ›å»ºæŠ½ç­¾å¯¹è±¡
            const draw = {
                id: drawId,
                name: drawName,
                creator: creatorName,
                created: new Date().toLocaleString('zh-CN'),
                groupConfig: groupConfig,
                totalCapacity: totalCapacity,
                allTeams: allTeams,
                seedTeams: selectedSeeds,
                password: password,
                teams: [], // å·²é€‰æ‹©çš„é˜Ÿä¼
                groups: {},
                joinCode: generateId().substring(0, 4), // ç®€åŒ–çš„åŠ å…¥ä»£ç 
                status: 'active',
                groupSeedCount: {}, // è®°å½•æ¯ä¸ªç»„çš„ç§å­é˜Ÿæ•°é‡
                rules: 'ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ï¼Œç¡®ä¿åˆ†ç»„å‡è¡¡ã€‚å‚ä¸è€…æ— æ³•åŒºåˆ†ç§å­é˜Ÿä¸æ™®é€šé˜Ÿã€‚',
                participants: {} // è®°å½•å‚ä¸è€…ä¿¡æ¯
            };
            
            // åˆå§‹åŒ–åˆ†ç»„ç»“æ„
            for (const [groupName, capacity] of Object.entries(groupConfig)) {
                draw.groups[groupName] = {
                    name: groupName,
                    capacity: capacity,
                    teams: [],
                    seatsLeft: capacity,
                    seedCount: 0 // è¯¥ç»„çš„ç§å­é˜Ÿæ•°é‡
                };
                
                // åˆå§‹åŒ–ç»„ç§å­é˜Ÿè®¡æ•°
                draw.groupSeedCount[groupName] = 0;
            }
            
            // ä¿å­˜æŠ½ç­¾
            draws[drawId] = draw;
            localStorage.setItem('basketballDraws', JSON.stringify(draws));
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            showMessage('success', 'æŠ½ç­¾åˆ›å»ºæˆåŠŸï¼æ­£åœ¨è·³è½¬åˆ°æŠ½ç­¾é¡µé¢...');
            
            // è·³è½¬åˆ°æŠ½ç­¾é¡µé¢
            setTimeout(() => {
                currentDraw = draw;
                showDrawPage();
            }, 1000);
        }
        
        // æ˜¾ç¤ºæŠ½ç­¾é¡µé¢
        function showDrawPage() {
            // éšè—ä¸»é¡µé¢
            document.getElementById('mainPage').style.display = 'none';
            
            // æ˜¾ç¤ºæŠ½ç­¾é¡µé¢
            document.getElementById('drawPage').style.display = 'block';
            
            // è®¾ç½®æŠ½ç­¾ä¿¡æ¯
            document.getElementById('drawTitle').textContent = currentDraw.name;
            document.getElementById('drawIdDisplay').textContent = currentDraw.id;
            document.getElementById('drawCreator').textContent = currentDraw.creator;
            document.getElementById('totalCapacity').textContent = currentDraw.totalCapacity;
            
            // æ›´æ–°è§„åˆ™è¯´æ˜
            updateRulesDisplay();
            
            // æ›´æ–°åˆ†äº«é“¾æ¥
            const shareLink = `${window.location.origin}${window.location.pathname}?id=${currentDraw.id}`;
            document.getElementById('shareLink').textContent = shareLink;
            
            // æ›´æ–°é¡µé¢å†…å®¹
            updateDrawPage();
        }
        
        // æ›´æ–°è§„åˆ™è¯´æ˜
        function updateRulesDisplay() {
            const rulesContent = document.getElementById('rulesContent');
            
            rulesContent.innerHTML = `
                <strong>æŠ½ç­¾è§„åˆ™ï¼š</strong><br>
                å‚ä¸è€…é€‰æ‹©é˜Ÿä¼åï¼Œç³»ç»Ÿå°†éšæœºåˆ†é…åˆ°æœ‰ç©ºä½çš„å°ç»„ï¼Œç¡®ä¿åˆ†ç»„å‡è¡¡ã€‚
                <br><br>
                <strong>åˆ†ç»„æƒ…å†µï¼š</strong><br>
                å…±${Object.keys(currentDraw.groupConfig).length}ä¸ªå°ç»„ï¼Œæ€»å®¹é‡${currentDraw.totalCapacity}é˜Ÿã€‚
                ${currentDraw.seedTeams.length > 0 ? `ç³»ç»Ÿå·²è®¾ç½®${currentDraw.seedTeams.length}æ”¯ç§å­é˜Ÿï¼Œå°†è‡ªåŠ¨å‡è¡¡åˆ†é…åˆ°ä¸åŒå°ç»„ã€‚` : ''}
            `;
        }
        
        // æ›´æ–°æŠ½ç­¾é¡µé¢
        function updateDrawPage() {
            // æ›´æ–°å¯ç”¨é˜Ÿä¼é€‰æ‹©
            updateAvailableTeams();
            
            // æ›´æ–°åˆ†ç»„æ˜¾ç¤º
            updateGroupsDisplay();
            
            // æ›´æ–°è¿›åº¦
            updateProgress();
            
            // æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦å·²å‚ä¸
            checkCurrentParticipant();
            
            // æ›´æ–°å‰©ä½™é˜Ÿä¼æ•°
            const remaining = currentDraw.allTeams.length - currentDraw.teams.length;
            document.getElementById('remainingTeams').textContent = remaining;
        }
        
        // æ›´æ–°å¯ç”¨é˜Ÿä¼é€‰æ‹©
        function updateAvailableTeams() {
            const selectElement = document.getElementById('availableTeams');
            
            // æ¸…ç©ºå½“å‰é€‰é¡¹
            selectElement.innerHTML = '<option value="" disabled selected>è¯·é€‰æ‹©æ‚¨çš„é˜Ÿä¼...</option>';
            
            // è·å–å·²é€‰æ‹©çš„é˜Ÿä¼
            const selectedTeams = new Set(currentDraw.teams.map(t => t.name));
            
            // æ·»åŠ æœªé€‰æ‹©çš„é˜Ÿä¼é€‰é¡¹
            currentDraw.allTeams.forEach(team => {
                if (!selectedTeams.has(team)) {
                    const option = document.createElement('option');
                    option.value = team;
                    option.textContent = team;
                    selectElement.appendChild(option);
                }
            });
        }
        
        // æ£€æŸ¥å½“å‰å‚ä¸è€…æ˜¯å¦å·²å‚ä¸
        function checkCurrentParticipant() {
            // æ£€æŸ¥localStorageä¸­æ˜¯å¦æœ‰å½“å‰æŠ½ç­¾çš„å‚ä¸è€…ä¿¡æ¯
            const participantKey = `participant_${currentDraw.id}`;
            const participantInfo = JSON.parse(localStorage.getItem(participantKey));
            
            if (participantInfo) {
                // éªŒè¯è¯¥å‚ä¸è€…ä¿¡æ¯æ˜¯å¦æœ‰æ•ˆï¼ˆé˜Ÿä¼æ˜¯å¦è¿˜å­˜åœ¨ï¼‰
                const teamExists = currentDraw.teams.some(team => 
                    team.name === participantInfo.team && 
                    team.selectedByName === participantInfo.name
                );
                
                if (teamExists) {
                    // æ˜¾ç¤ºå·²å‚ä¸ä¿¡æ¯
                    currentParticipant = participantInfo;
                    document.getElementById('participantForm').style.display = 'none';
                    document.getElementById('alreadyParticipated').style.display = 'block';
                    
                    // æŸ¥æ‰¾å‚ä¸è€…çš„é˜Ÿä¼ä¿¡æ¯
                    let teamInfo = null;
                    for (const [groupName, groupInfo] of Object.entries(currentDraw.groups)) {
                        for (const team of groupInfo.teams) {
                            if (team.name === participantInfo.team && team.selectedByName === participantInfo.name) {
                                teamInfo = team;
                                break;
                            }
                        }
                        if (teamInfo) break;
                    }
                    
                    if (teamInfo) {
                        document.getElementById('myTeamInfo').innerHTML = `
                            å‚ä¸è€…ï¼š<strong>${teamInfo.selectedByName}</strong><br>
                            æ‚¨çš„é˜Ÿä¼ï¼š<strong>${teamInfo.name}</strong><br>
                            æ‰€åœ¨å°ç»„ï¼š<strong>${teamInfo.group}ç»„</strong>
                        `;
                    }
                } else {
                    // å‚ä¸è€…ä¿¡æ¯æ— æ•ˆï¼Œæ¸…é™¤
                    localStorage.removeItem(participantKey);
                    currentParticipant = null;
                    document.getElementById('participantForm').style.display = 'block';
                    document.getElementById('alreadyParticipated').style.display = 'none';
                }
            } else {
                currentParticipant = null;
                document.getElementById('participantForm').style.display = 'block';
                document.getElementById('alreadyParticipated').style.display = 'none';
            }
        }
        
        // å‚ä¸æŠ½ç­¾
        function participateDraw() {
            const participantName = document.getElementById('participantName').value.trim();
            const teamName = document.getElementById('availableTeams').value;
            
            // éªŒè¯è¾“å…¥
            if (!participantName) {
                showMessage('error', 'è¯·è¾“å…¥æ‚¨çš„å§“å');
                return;
            }
            
            if (!teamName) {
                showMessage('error', 'è¯·é€‰æ‹©é˜Ÿä¼');
                return;
            }
            
            // æ£€æŸ¥é˜Ÿä¼æ˜¯å¦å·²è¢«é€‰æ‹©
            for (const [groupName, groupInfo] of Object.entries(currentDraw.groups)) {
                for (const team of groupInfo.teams) {
                    if (team.name === teamName) {
                        showMessage('error', 'è¯¥é˜Ÿä¼å·²è¢«é€‰æ‹©ï¼Œè¯·é€‰æ‹©å…¶ä»–é˜Ÿä¼');
                        return;
                    }
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºç§å­é˜Ÿä¼
            const isSeed = currentDraw.seedTeams.includes(teamName);
            
            // æ‰¾åˆ°æœ‰ç©ºä½çš„å°ç»„
            const availableGroups = [];
            for (const [groupName, groupInfo] of Object.entries(currentDraw.groups)) {
                if (groupInfo.seatsLeft > 0) {
                    availableGroups.push({
                        name: groupName,
                        seedCount: groupInfo.seedCount,
                        seatsLeft: groupInfo.seatsLeft
                    });
                }
            }
            
            if (availableGroups.length === 0) {
                showMessage('error', 'æ‰€æœ‰å°ç»„å·²æ»¡ï¼Œæ— æ³•åˆ†é…');
                return;
            }
            
            let assignedGroup = null;
            
            if (isSeed) {
                // ç§å­é˜Ÿåˆ†é…é€»è¾‘ï¼šä¼˜å…ˆåˆ†é…åˆ°ç§å­é˜Ÿæœ€å°‘çš„å°ç»„
                // å…ˆæ‰¾å‡ºç§å­é˜Ÿæ•°é‡æœ€å°‘çš„å°ç»„
                const minSeedCount = Math.min(...availableGroups.map(g => g.seedCount));
                const groupsWithMinSeed = availableGroups.filter(g => g.seedCount === minSeedCount);
                
                // å¦‚æœæœ‰å¤šä¸ªå°ç»„ç§å­é˜Ÿæ•°é‡ç›¸åŒï¼Œéšæœºé€‰æ‹©ä¸€ä¸ª
                assignedGroup = groupsWithMinSeed[Math.floor(Math.random() * groupsWithMinSeed.length)].name;
            } else {
                // éç§å­é˜Ÿï¼šéšæœºåˆ†é…åˆ°æœ‰ç©ºä½çš„å°ç»„
                // ä½†ä¹Ÿè¦è€ƒè™‘å‡è¡¡æ€§ï¼Œä¼˜å…ˆåˆ†é…åˆ°ç§å­é˜Ÿè¾ƒå¤šçš„å°ç»„ï¼ˆå› ä¸ºç§å­é˜Ÿè¾ƒå°‘çš„å°ç»„å¯èƒ½å·²è¢«ç§å­é˜Ÿå æ®ï¼‰
                // è¿™æ ·å¯ä»¥ç¡®ä¿ç§å­é˜Ÿå’Œéç§å­é˜Ÿéƒ½å‡è¡¡åˆ†å¸ƒ
                
                // è®¡ç®—æ¯ä¸ªç»„çš„æƒé‡ï¼šç§å­é˜Ÿè¶Šå¤šï¼Œæƒé‡è¶Šä½ï¼ˆä¼˜å…ˆåˆ†é…ç»™ç§å­é˜Ÿå°‘çš„å°ç»„ï¼‰
                const weightedGroups = [];
                availableGroups.forEach(group => {
                    // ç§å­é˜Ÿæ•°é‡è¶Šå°‘ï¼Œæƒé‡è¶Šé«˜ï¼ˆæ›´å®¹æ˜“è¢«é€‰ä¸­ï¼‰
                    const weight = 1 / (group.seedCount + 1);
                    weightedGroups.push({ name: group.name, weight });
                });
                
                // æ ¹æ®æƒé‡éšæœºé€‰æ‹©
                const totalWeight = weightedGroups.reduce((sum, g) => sum + g.weight, 0);
                let random = Math.random() * totalWeight;
                
                for (const group of weightedGroups) {
                    random -= group.weight;
                    if (random <= 0) {
                        assignedGroup = group.name;
                        break;
                    }
                }
                
                // å¦‚æœä¸Šé¢çš„ç®—æ³•æ²¡é€‰å‡ºæ¥ï¼Œéšæœºé€‰ä¸€ä¸ª
                if (!assignedGroup) {
                    assignedGroup = availableGroups[Math.floor(Math.random() * availableGroups.length)].name;
                }
            }
            
            // æ·»åŠ é˜Ÿä¼åˆ°å°ç»„
            const teamInfo = {
                name: teamName,
                isSeed: isSeed,
                group: assignedGroup,
                selectedAt: new Date().toLocaleString('zh-CN'),
                selectedByName: participantName,
                participantId: Date.now().toString() + Math.random().toString(36).substr(2, 9)
            };
            
            currentDraw.groups[assignedGroup].teams.push(teamInfo);
            currentDraw.groups[assignedGroup].seatsLeft--;
            
            // å¦‚æœæ˜¯ç§å­é˜Ÿï¼Œæ›´æ–°è¯¥ç»„çš„ç§å­é˜Ÿè®¡æ•°
            if (isSeed) {
                currentDraw.groups[assignedGroup].seedCount++;
                currentDraw.groupSeedCount[assignedGroup]++;
            }
            
            // æ·»åŠ åˆ°å·²é€‰æ‹©é˜Ÿä¼åˆ—è¡¨
            currentDraw.teams.push(teamInfo);
            
            // è®°å½•å‚ä¸è€…ä¿¡æ¯
            currentParticipant = {
                name: participantName,
                team: teamName,
                group: assignedGroup,
                participantId: teamInfo.participantId,
                participatedAt: new Date().toISOString()
            };
            
            // ä¿å­˜åˆ°localStorage
            const participantKey = `participant_${currentDraw.id}`;
            localStorage.setItem(participantKey, JSON.stringify(currentParticipant));
            
            // ä¿å­˜æ›´æ–°
            draws[currentDraw.id] = currentDraw;
            localStorage.setItem('basketballDraws', JSON.stringify(draws));
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            showMessage('success', `${participantName} å·²æˆåŠŸé€‰æ‹© ${teamName}ï¼åˆ†é…åˆ° ${assignedGroup}ç»„`);
            
            // æ›´æ–°é¡µé¢
            updateDrawPage();
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('participantName').value = '';
            document.getElementById('availableTeams').value = '';
        }
        
        // æ›´æ–°åˆ†ç»„æ˜¾ç¤º
        function updateGroupsDisplay() {
            const container = document.getElementById('groupsContainer');
            container.innerHTML = '';
            
            for (const [groupName, groupInfo] of Object.entries(currentDraw.groups)) {
                const groupCard = document.createElement('div');
                groupCard.className = 'group-card';
                
                let teamsHTML = '';
                
                // æ˜¾ç¤ºæ‰€æœ‰é˜Ÿä¼ï¼ˆå‚ä¸è€…çœ‹ä¸åˆ°ç§å­é˜Ÿæ ‡è¯†ï¼‰
                if (groupInfo.teams.length > 0) {
                    groupInfo.teams.forEach(team => {
                        teamsHTML += `
                            <div class="team-item">
                                <span>${team.name}</span>
                                <span class="team-number">${team.selectedByName}</span>
                            </div>
                        `;
                    });
                } else {
                    teamsHTML = '<div style="color: #999; text-align: center; padding: 20px;">æš‚æ— é˜Ÿä¼</div>';
                }
                
                // ç©ºä½
                if (groupInfo.seatsLeft > 0) {
                    teamsHTML += `
                        <div style="margin-top: 15px; color: #666;">
                            <strong>å‰©ä½™ç©ºä½ï¼š${groupInfo.seatsLeft}ä¸ª</strong>
                        </div>
                    `;
                }
                
                groupCard.innerHTML = `
                    <div class="group-header">${groupName}ç»„ (${groupInfo.teams.length}/${groupInfo.capacity})</div>
                    <div class="group-body">
                        ${teamsHTML}
                    </div>
                `;
                
                container.appendChild(groupCard);
            }
        }
        
        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            const selectedCount = currentDraw.teams.length;
            const totalCount = currentDraw.totalCapacity;
            const percent = Math.round((selectedCount / totalCount) * 100);
            
            document.getElementById('progressText').textContent = `${selectedCount}/${totalCount}`;
            document.getElementById('progressFill').style.width = `${percent}%`;
        }
        
        // å¤åˆ¶åˆ†äº«é“¾æ¥
        function copyShareLink() {
            const shareLink = document.getElementById('shareLink').textContent;
            
            // ä½¿ç”¨ç°ä»£å¤åˆ¶API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(shareLink).then(() => {
                    showMessage('success', 'é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                }).catch(err => {
                    fallbackCopyText(shareLink);
                });
            } else {
                fallbackCopyText(shareLink);
            }
        }
        
        // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
        function fallbackCopyText(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showMessage('success', 'é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                } else {
                    showMessage('error', 'å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥');
                }
            } catch (err) {
                showMessage('error', 'å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥');
            }
            
            document.body.removeChild(textArea);
        }
        
        // è¿”å›ä¸»é¡µ
        function backToMain() {
            document.getElementById('drawPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'block';
            
            // æ¸…ç©ºè¡¨å•
            const formFields = ['drawName', 'creatorName', 'teamList', 'password', 'joinCode', 'manageCode', 'managePassword', 'customConfig'];
            formFields.forEach(field => {
                const element = document.getElementById(field);
                if (element) element.value = '';
            });
            
            // é‡ç½®ç§å­é€‰æ‹©
            document.getElementById('seedTeams').innerHTML = '<option value="" disabled selected>è¯·å…ˆä»ä¸Šæ–¹è¾“å…¥é˜Ÿä¼åç§°</option>';
            
            // é‡ç½®åˆ†ç»„é…ç½®
            document.getElementById('groupConfig').value = '';
            document.getElementById('customConfigSection').style.display = 'none';
            
            // éšè—æ¶ˆæ¯æç¤º
            hideMessages();
            
            // é‡ç½®å½“å‰å‚ä¸è€…å’ŒæŠ½ç­¾
            currentParticipant = null;
            currentDraw = null;
        }
        
        // å‚ä¸æŠ½ç­¾ï¼ˆè¿›å…¥æŠ½ç­¾é¡µé¢ï¼‰
        function joinDraw() {
            const joinCode = document.getElementById('joinCode').value.trim().toUpperCase();
            
            if (!joinCode) {
                showMessage('error', 'è¯·è¾“å…¥æŠ½ç­¾é“¾æ¥æˆ–ID');
                return;
            }
            
            // æŸ¥æ‰¾æŠ½ç­¾
            let foundDraw = null;
            
            // å…ˆå°è¯•ç›´æ¥åŒ¹é…ID
            if (draws[joinCode]) {
                foundDraw = draws[joinCode];
            } else {
                // å°è¯•åŒ¹é…åŠ å…¥ä»£ç 
                for (const drawId in draws) {
                    if (draws[drawId].joinCode === joinCode) {
                        foundDraw = draws[drawId];
                        break;
                    }
                }
            }
            
            if (!foundDraw) {
                showMessage('error', 'æœªæ‰¾åˆ°å¯¹åº”çš„æŠ½ç­¾ï¼Œè¯·æ£€æŸ¥IDæ˜¯å¦æ­£ç¡®');
                return;
            }
            
            // è®¾ç½®å½“å‰æŠ½ç­¾
            currentDraw = foundDraw;
            
            // æ˜¾ç¤ºæŠ½ç­¾é¡µé¢
            showDrawPage();
        }
        
        // ç®¡ç†æŠ½ç­¾
        function manageDraw() {
            const manageCode = document.getElementById('manageCode').value.trim();
            const managePassword = document.getElementById('managePassword').value.trim();
            
            if (!manageCode || !managePassword) {
                showMessage('error', 'è¯·è¾“å…¥æŠ½ç­¾IDå’Œç®¡ç†å¯†ç ');
                return;
            }
            
            if (!draws[manageCode]) {
                showMessage('error', 'æŠ½ç­¾IDä¸å­˜åœ¨');
                return;
            }
            
            if (draws[manageCode].password !== managePassword) {
                showMessage('error', 'ç®¡ç†å¯†ç é”™è¯¯');
                return;
            }
            
            currentDraw = draws[manageCode];
            
            // æ˜¾ç¤ºæŠ½ç­¾é¡µé¢
            showDrawPage();
            
            // æ˜¾ç¤ºç®¡ç†åŠŸèƒ½
            showMessage('success', 'ç®¡ç†æƒé™éªŒè¯æˆåŠŸï¼');
        }
    </script>
</body>
</html>